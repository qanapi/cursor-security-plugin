---
description: Secrets management to prevent hardcoded credentials, API keys in source, and secrets in logs
alwaysApply: true
---

# Secrets Management

## Vulnerability Description

Hardcoded credentials, API keys, and tokens in source code or configuration files allow attackers who gain access to the repository or deployment artifacts to impersonate the application or access external services. Secrets in logs, error messages, or responses expose credentials to anyone with log access. Credentials must be managed externally, never committed to version control, and never included in observable output.

## Anti-Patterns to Avoid

### Hardcoded Passwords and Keys

```
password = "admin123"
api_key = "sk_live_abc123xyz"
db_password = "secret_db_pass"
token = "ghp_xxxxxxxxxxxxxxxxxxxx"
```

### Secrets in Configuration Files Committed to Repo

```
config = {
  database: { password: "prod_password" },
  stripe_key: "sk_live_xxx",
  aws_secret: "wJalrXUtnFEMI/K7MDENG"
}
```

### Secrets in Environment Variable Defaults in Code

```
api_key = os.getenv("API_KEY", "fallback_key_12345")
```

### Logging Secrets

```
log("Connecting with password: " + password)
log("Request failed", { headers: request.headers })
log("Auth token: " + token)
```

### Including Secrets in Error Messages

```
throw new Error("Database connection failed: " + connection_string)
return { error: "Invalid key: " + api_key }
```

### Secrets in URLs

```
url = "https://user:password@api.example.com/data"
```

### Committing Secret Files

```
.gitignore:
# (no entries for .env, secrets.json, *.pem, credentials)
```

### Overprivileged Service Accounts

```
db_user = "root"
aws_role = "AdministratorAccess"
```

## Secure Patterns

### Use Environment Variables or Secret Managers

```
api_key = os.getenv("API_KEY")
if (!api_key) {
  fail("API_KEY not set")
}

secret = vault.read("secret/data/api/keys")
db_password = secrets_manager.get("prod/db/password")
```

Load secrets from environment variables at runtime or from secret managers (HashiCorp Vault, AWS Secrets Manager, Azure Key Vault, GCP Secret Manager). Never provide default values for secrets in code.

### Add Secret Files to .gitignore

```
.env
.env.local
.env.*.local
secrets.json
*.pem
*.key
credentials
config/secrets.*
```

Ensure all files that may contain secrets are ignored. Use .env.example with placeholder values and document required variables.

### Never Log Secrets or Include in Error Messages

```
log("Database connection failed", { host: config.host, port: config.port })
log("Auth failed for user", { user_id: user.id })
```

Log metadata (host, port, user ID) but never passwords, tokens, API keys, or connection strings. Redact or mask before logging if necessary.

### Rotate Credentials Regularly

```
schedule_rotation(secret_id, interval_days=90)
alert_before_expiry(secret_id, days=7)
```

Establish rotation policies. Automate rotation where possible. Alert before expiry to avoid service disruption.

### Use Least-Privilege Service Accounts

```
db_user = "app_readwrite"
aws_role = "app-s3-readonly"
```

Create dedicated service accounts with minimal permissions. Avoid shared admin or root accounts.

### Use Secure Secret Injection in CI/CD

```
secrets:
  - name: API_KEY
    value_from: vault:secret/api#key
```

Inject secrets at deployment time from secure stores. Never store secrets in CI/CD configuration as plaintext.

### Validate Secret Presence at Startup

```
required = ["API_KEY", "DB_PASSWORD", "JWT_SECRET"]
for key in required:
  if not os.getenv(key):
    fail("Missing required secret: " + key)
```

Fail fast if required secrets are not configured. Do not proceed with placeholder or empty values.

### Use Short-Lived Tokens Where Possible

```
token = oauth_client.get_token(client_credentials)
token = assume_role(duration=3600)
```

Prefer short-lived tokens over long-lived API keys. Use OAuth, OIDC, or IAM role assumption for temporary credentials.

## Standards Mapping

| Standard | ID |
|----------|-----|
| OWASP Top 10 2021 | A02:2021 – Cryptographic Failures |
| OWASP Top 10 2021 | A07:2021 – Identification and Authentication Failures |
| CWE | 798 – Use of Hard-coded Credentials |
| CWE | 259 – Use of Hard-coded Password |
| CWE | 532 – Insertion of Sensitive Information into Log File |
